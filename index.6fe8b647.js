!function(){var t={};function e(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function s(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=Array(e);s<e;s++)i[s]=t[s];return i}function a(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return r(t,void 0);var s=Object.prototype.toString.call(t).slice(8,-1);if("Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s)return Array.from(s);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return r(t,void 0)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}t=/*#__PURE__*/function(){function t(s){e(this,t),this.inicialState=s,this.state=this.inicialState.map(function(t){return a(t)}),this.futureState=[],this.score=0,this.status="idle",this.startGame=!1}return i(t,[{key:"slide",value:function(t){for(var e=this.filterZero(t),s=0;s<e.length;s++)e[s]===e[s+1]&&(e[s]*=2,e[s+1]=0,this.score+=e[s]);for(e=this.filterZero(e);e.length<4;)e.push(0);return e}},{key:"filterZero",value:function(t){return t.filter(function(t){return 0!==t})}},{key:"isEqual",value:function(t,e){for(var s=0;s<t.length;s++)for(var i=0;i<t[s].length;i++)if(t[s][i]!==e[s][i])return!1;return!0}},{key:"moveLeft",value:function(){if(this.startGame){for(var t=0;t<4;t++){var e=a(this.state[t]);e=this.slide(e),this.futureState[t]=e}!this.isEqual(this.futureState,this.state)&&(this.state=this.futureState.map(function(t){return a(t)}),this.setTwo(),this.isWin(this.state),this.isLose()&&(this.status="lose"))}}},{key:"moveRight",value:function(){if(this.startGame){for(var t=0;t<4;t++){var e=a(this.state[t]);e.reverse(),(e=this.slide(e)).reverse(),this.futureState[t]=e}!this.isEqual(this.futureState,this.state)&&(this.state=this.futureState.map(function(t){return a(t)}),this.setTwo(),this.isWin(this.state),this.isLose()&&(this.status="lose"))}}},{key:"moveUp",value:function(){if(this.startGame){this.futureState=this.state.map(function(t){return a(t)});for(var t=0;t<4;t++){var e=[this.futureState[0][t],this.futureState[1][t],this.futureState[2][t],this.futureState[3][t]];e=this.slide(e);for(var s=0;s<4;s++)this.futureState[s][t]=e[s]}!this.isEqual(this.futureState,this.state)&&(this.state=this.futureState.map(function(t){return a(t)}),this.setTwo(),this.isWin(this.state),this.isLose()&&(this.status="lose"))}}},{key:"moveDown",value:function(){if(this.startGame){this.futureState=this.state.map(function(t){return a(t)});for(var t=0;t<4;t++){var e=[this.futureState[0][t],this.futureState[1][t],this.futureState[2][t],this.futureState[3][t]];e.reverse(),(e=this.slide(e)).reverse();for(var s=0;s<4;s++)this.futureState[s][t]=e[s]}!this.isEqual(this.futureState,this.state)&&(this.state=this.futureState.map(function(t){return a(t)}),this.setTwo(),this.isWin(this.state),this.isLose()&&(this.status="lose"))}}},{key:"start",value:function(){this.status="playing",this.startGame=!0,this.state=this.inicialState.map(function(t){return a(t)}),this.score=0,this.setTwo(),this.setTwo()}},{key:"restart",value:function(){this.status="idle",this.startGame=!1,this.state=this.inicialState.map(function(t){return a(t)}),this.score=0}},{key:"setTwo",value:function(){if(this.hasEmptyTile())for(var t=!1;!t;){var e=Math.floor(4*Math.random()),s=Math.floor(4*Math.random());if(0===this.state[e][s]){var i=.9>Math.random()?2:4;this.state[e][s]=i,t=!0}}}},{key:"hasEmptyTile",value:function(){for(var t=0;t<4;t++)for(var e=0;e<4;e++)if(0===this.state[t][e])return!0;return!1}},{key:"isWin",value:function(t){var e=this;t.forEach(function(t){t.forEach(function(t){2048===t&&(e.status="win")})})}},{key:"isLose",value:function(){var t=!0,e=!1,s=void 0;try{for(var i,r=this.state[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var a=function(){var t=i.value;if(t.some(function(t){return 0===t}))return{v:!1};for(var e=0;e<t.length;e++)if(t[e]===t[e+1])return{v:!1}}();if("object"==(a&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a))return a.v}}catch(t){e=!0,s=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw s}}for(var n=0;n<4;n++)for(var o=[this.state[0][n],this.state[1][n],this.state[2][n],this.state[3][n]],u=0;u<o.length;u++)if(o[u]===o[u+1])return!1;return!0}},{key:"updateTile",value:function(t,e){t.innerText="",t.classList.value="",t.classList.add("field__cell"),e>0&&(t.innerText=e,t.classList.add("field__cell--"+e.toString()))}},{key:"updateScore",value:function(t){t.innerText=this.score}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.state.map(function(t){return a(t)})}},{key:"getStatus",value:function(){return this.status}},{key:"setBestScore",value:function(t,e){(isNaN(e=parseInt(sessionStorage.getItem("user"),10))||e<t)&&sessionStorage.setItem("user",t.toString())}},{key:"getBestScore",value:function(){var t=sessionStorage.getItem("user");return t?parseInt(t,10):0}}]),t}();var n={},o={};o=function t(s,i,r){e(this,t);var a=document.createElement("div");a.classList.add("field__cell"),s.append(a),this.x=i,this.y=r,a.id="".concat(this.y,"-").concat(this.x)},n=/*#__PURE__*/function(){function t(s){e(this,t),this.cells=[];for(var i=0;i<16;i++)this.cells.push(new o(s,i%4,Math.floor(i/4)));this.size=4}return i(t,[{key:"initializeBoard",value:function(){for(var t=[],e=0;e<4;e++)t.push([,,,,].fill(0));return t}}]),t}();new/*#__PURE__*/(function(){function t(s){var i=this;e(this,t),this.canvas=s,this.ctx=this.canvas.getContext("2d"),this.width=window.innerWidth,this.height=window.innerHeight,this.centerX=this.width/2,this.centerY=this.height/2,this.dots=[],this.maxDots=150,this.speed=.5,this.resizeCanvas(),this.createDots(),this.animate(),window.addEventListener("resize",function(){return i.resizeCanvas()})}return i(t,[{key:"resizeCanvas",value:function(){this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.centerX=this.width/2,this.centerY=this.height/2}},{key:"createDots",value:function(){for(var t=0;t<this.maxDots;t++)this.dots.push(this.createDot())}},{key:"createDot",value:function(){var t=2*Math.random()*Math.PI,e=Math.random()*(this.width/2);return{x:Math.cos(t)*e+this.centerX,y:Math.sin(t)*e+this.centerY,radius:2*Math.random()+1,speed:Math.random()*this.speed+.5,angle:t,distance:e}}},{key:"updateDot",value:function(t){if(t.distance+=t.speed,t.x=Math.cos(t.angle)*t.distance+this.centerX,t.y=Math.sin(t.angle)*t.distance+this.centerY,t.x<0||t.x>this.width||t.y<0||t.y>this.height){var e=2*Math.random()*Math.PI;t.distance=0,t.x=Math.cos(e)*t.distance+this.centerX,t.y=Math.sin(e)*t.distance+this.centerY,t.speed=Math.random()*this.speed+.5}}},{key:"drawDot",value:function(t){this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),this.ctx.fillStyle="#446583",this.ctx.fill(),this.ctx.closePath()}},{key:"animate",value:function(){var t=this;this.ctx.clearRect(0,0,this.width,this.height),this.dots.forEach(function(e){t.updateDot(e),t.drawDot(e)}),requestAnimationFrame(function(){return t.animate()})}}]),t}())(document.getElementById("tunnel-background"));var u={score:document.querySelector('[data-score="score"]'),best:document.querySelector('[data-best="best"]'),start:document.querySelector(".button"),field:document.querySelector(".field"),messageWin:document.querySelector(".message__content--win"),messageLose:document.querySelector(".message__content--lose"),messageStart:document.querySelector(".message__content--start"),messageKeyboard:document.querySelector(".message__content--keyboard")},h=new n(u.field),c=0,l=new t(h.initializeBoard()),f=l.getBestScore();function d(){for(var t=0;t<h.size;t++)for(var e=0;e<h.size;e++){var s=document.getElementById("".concat(t,"-").concat(e)),i=l.getState()[t][e];l.updateTile(s,i)}var r=l.getScore();r>f&&(f=r,l.setBestScore(f),u.best.innerText=f)}function v(){"Start"===u.start.textContent&&(l.start(),d(),l.updateScore(u.score),u.messageStart.classList.add("hidden"),u.messageKeyboard.classList.remove("hidden")),"New Game"===u.start.textContent&&("win"===l.getStatus()&&u.messageWin.classList.add("hidden"),"lose"===l.getStatus()&&u.messageLose.classList.add("hidden"),l.restart(),u.start.innerText="Start",u.start.classList.add("start"),u.start.classList.remove("restart"),c=0,d(),l.updateScore(u.score),u.messageStart.classList.remove("hidden"),u.messageKeyboard.classList.add("hidden"))}u.best&&(u.best.innerText=l.getBestScore()),u.score&&(u.score.innerText=l.getScore()),d(),u.start.addEventListener("click",v),u.messageStart.addEventListener("click",function(){v()}),document.addEventListener("keydown",function(t){("ArrowUp"===t.key||"ArrowDown"===t.key)&&t.preventDefault()}),document.addEventListener("keyup",function(t){switch(u.messageKeyboard.classList.contains("hidden")||u.messageKeyboard.classList.add("hidden"),l.getStatus()){case"playing":switch(t.code){case"ArrowLeft":l.moveLeft();break;case"ArrowRight":l.moveRight();break;case"ArrowUp":l.moveUp();break;case"ArrowDown":l.moveDown()}d(),c++;break;case"win":u.messageWin.classList.remove("hidden");break;case"lose":u.messageLose.classList.remove("hidden")}l.updateScore(u.score);var e=window.localStorage.getItem("user");l.setBestScore(l.getScore(),e),c>=1&&(u.start.innerText="New Game",u.start.classList.remove("start"),u.start.classList.add("restart"),u.start.blur())})}();
//# sourceMappingURL=index.6fe8b647.js.map
