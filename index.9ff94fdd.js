var t={};t=class{constructor(t){this.inicialState=t,this.state=this.inicialState.map(t=>[...t]),this.futureState=[],this.score=0,this.status="idle",this.startGame=!1}slide(t){let e=this.filterZero(t);for(let t=0;t<e.length;t++)e[t]===e[t+1]&&(e[t]*=2,e[t+1]=0,this.score+=e[t]);for(e=this.filterZero(e);e.length<4;)e.push(0);return e}filterZero(t){return t.filter(t=>0!==t)}isEqual(t,e){for(let s=0;s<t.length;s++)for(let i=0;i<t[s].length;i++)if(t[s][i]!==e[s][i])return!1;return!0}moveLeft(){if(this.startGame){for(let t=0;t<4;t++){let e=[...this.state[t]];e=this.slide(e),this.futureState[t]=e}!this.isEqual(this.futureState,this.state)&&(this.state=this.futureState.map(t=>[...t]),this.setTwo(),this.isWin(this.state),this.isLose()&&(this.status="lose"))}}moveRight(){if(this.startGame){for(let t=0;t<4;t++){let e=[...this.state[t]];e.reverse(),(e=this.slide(e)).reverse(),this.futureState[t]=e}!this.isEqual(this.futureState,this.state)&&(this.state=this.futureState.map(t=>[...t]),this.setTwo(),this.isWin(this.state),this.isLose()&&(this.status="lose"))}}moveUp(){if(this.startGame){this.futureState=this.state.map(t=>[...t]);for(let t=0;t<4;t++){let e=[this.futureState[0][t],this.futureState[1][t],this.futureState[2][t],this.futureState[3][t]];e=this.slide(e);for(let s=0;s<4;s++)this.futureState[s][t]=e[s]}!this.isEqual(this.futureState,this.state)&&(this.state=this.futureState.map(t=>[...t]),this.setTwo(),this.isWin(this.state),this.isLose()&&(this.status="lose"))}}moveDown(){if(this.startGame){this.futureState=this.state.map(t=>[...t]);for(let t=0;t<4;t++){let e=[this.futureState[0][t],this.futureState[1][t],this.futureState[2][t],this.futureState[3][t]];e.reverse(),(e=this.slide(e)).reverse();for(let s=0;s<4;s++)this.futureState[s][t]=e[s]}!this.isEqual(this.futureState,this.state)&&(this.state=this.futureState.map(t=>[...t]),this.setTwo(),this.isWin(this.state),this.isLose()&&(this.status="lose"))}}start(){this.status="playing",this.startGame=!0,this.state=this.inicialState.map(t=>[...t]),this.score=0,this.setTwo(),this.setTwo()}restart(){this.status="idle",this.startGame=!1,this.state=this.inicialState.map(t=>[...t]),this.score=0}setTwo(){if(!this.hasEmptyTile())return;let t=!1;for(;!t;){let e=Math.floor(4*Math.random()),s=Math.floor(4*Math.random());if(0===this.state[e][s]){let i=.9>Math.random()?2:4;this.state[e][s]=i,t=!0}}}hasEmptyTile(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0===this.state[t][e])return!0;return!1}isWin(t){t.forEach(t=>{t.forEach(t=>{2048===t&&(this.status="win")})})}isLose(){for(let t of this.state){if(t.some(t=>0===t))return!1;for(let e=0;e<t.length;e++)if(t[e]===t[e+1])return!1}for(let t=0;t<4;t++){let e=[this.state[0][t],this.state[1][t],this.state[2][t],this.state[3][t]];for(let t=0;t<e.length;t++)if(e[t]===e[t+1])return!1}return!0}updateTile(t,e){t.innerText="",t.classList.value="",t.classList.add("field__cell"),e>0&&(t.innerText=e,t.classList.add("field__cell--"+e.toString()))}updateScore(t){t.innerText=this.score}getScore(){return this.score}getState(){return this.state.map(t=>[...t])}getStatus(){return this.status}setBestScore(t,e){(isNaN(e=parseInt(sessionStorage.getItem("user"),10))||e<t)&&sessionStorage.setItem("user",t.toString())}getBestScore(){let t=sessionStorage.getItem("user");return t?parseInt(t,10):0}};var e={},s={};s=class{constructor(t,e,s){let i=document.createElement("div");i.classList.add("field__cell"),t.append(i),this.x=e,this.y=s,i.id=`${this.y}-${this.x}`}},e=class{constructor(t){this.cells=[];for(let e=0;e<16;e++)this.cells.push(new s(t,e%4,Math.floor(e/4)));this.size=4}initializeBoard(){let t=[];for(let e=0;e<4;e++)t.push([,,,,].fill(0));return t}};var i={};new class{constructor(t){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.width=window.innerWidth,this.height=window.innerHeight,this.centerX=this.width/2,this.centerY=this.height/2,this.dots=[],this.maxDots=150,this.speed=.5,this.resizeCanvas(),this.createDots(),this.animate(),window.addEventListener("resize",()=>this.resizeCanvas())}resizeCanvas(){this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.centerX=this.width/2,this.centerY=this.height/2}createDots(){for(let t=0;t<this.maxDots;t++)this.dots.push(this.createDot())}createDot(){let t=2*Math.random()*Math.PI,e=Math.random()*(this.width/2);return{x:Math.cos(t)*e+this.centerX,y:Math.sin(t)*e+this.centerY,radius:2*Math.random()+1,speed:Math.random()*this.speed+.5,angle:t,distance:e}}updateDot(t){if(t.distance+=t.speed,t.x=Math.cos(t.angle)*t.distance+this.centerX,t.y=Math.sin(t.angle)*t.distance+this.centerY,t.x<0||t.x>this.width||t.y<0||t.y>this.height){let e=2*Math.random()*Math.PI;t.distance=0,t.x=Math.cos(e)*t.distance+this.centerX,t.y=Math.sin(e)*t.distance+this.centerY,t.speed=Math.random()*this.speed+.5}}drawDot(t){this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),this.ctx.fillStyle="#446583",this.ctx.fill(),this.ctx.closePath()}animate(){this.ctx.clearRect(0,0,this.width,this.height),this.dots.forEach(t=>{this.updateDot(t),this.drawDot(t)}),requestAnimationFrame(()=>this.animate())}}(document.getElementById("tunnel-background"));const a={score:document.querySelector('[data-score="score"]'),best:document.querySelector('[data-best="best"]'),start:document.querySelector(".button"),field:document.querySelector(".field"),messageWin:document.querySelector(".message__content--win"),messageLose:document.querySelector(".message__content--lose"),messageStart:document.querySelector(".message__content--start"),messageKeyboard:document.querySelector(".message__content--keyboard")},r=new e(a.field);let h=0;const o=new t(r.initializeBoard());let n=o.getBestScore();function c(){for(let t=0;t<r.size;t++)for(let e=0;e<r.size;e++){let s=document.getElementById(`${t}-${e}`),i=o.getState()[t][e];o.updateTile(s,i)}let t=o.getScore();t>n&&(n=t,o.setBestScore(n),a.best.innerText=n)}function l(){"Start"===a.start.textContent&&(o.start(),c(),o.updateScore(a.score),a.messageStart.classList.add("hidden"),a.messageKeyboard.classList.remove("hidden")),"New Game"===a.start.textContent&&("win"===o.getStatus()&&a.messageWin.classList.add("hidden"),"lose"===o.getStatus()&&a.messageLose.classList.add("hidden"),o.restart(),a.start.innerText="Start",a.start.classList.add("start"),a.start.classList.remove("restart"),h=0,c(),o.updateScore(a.score),a.messageStart.classList.remove("hidden"),a.messageKeyboard.classList.add("hidden"))}a.best&&(a.best.innerText=o.getBestScore()),a.score&&(a.score.innerText=o.getScore()),c(),a.start.addEventListener("click",l),a.messageStart.addEventListener("click",()=>{l()}),document.addEventListener("keydown",t=>{("ArrowUp"===t.key||"ArrowDown"===t.key)&&t.preventDefault()}),document.addEventListener("keyup",t=>{switch(a.messageKeyboard.classList.contains("hidden")||a.messageKeyboard.classList.add("hidden"),o.getStatus()){case"playing":switch(t.code){case"ArrowLeft":o.moveLeft();break;case"ArrowRight":o.moveRight();break;case"ArrowUp":o.moveUp();break;case"ArrowDown":o.moveDown()}c(),h++;break;case"win":a.messageWin.classList.remove("hidden");break;case"lose":a.messageLose.classList.remove("hidden")}o.updateScore(a.score);let e=window.localStorage.getItem("user");o.setBestScore(o.getScore(),e),h>=1&&(a.start.innerText="New Game",a.start.classList.remove("start"),a.start.classList.add("restart"),a.start.blur())});
//# sourceMappingURL=index.9ff94fdd.js.map
